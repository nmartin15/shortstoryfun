<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Short Story Pipeline</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#FFD700',
                            dark: '#CCAA00',
                            light: '#FFEE00',
                        },
                        background: {
                            DEFAULT: '#000000',
                            secondary: '#0a0a0a',
                            tertiary: '#141414',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Modern UI Libraries -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <!-- Lucide Icons (shadcn-style) -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-black text-white min-h-screen">
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8">
        <header class="bg-gradient-to-br from-background-secondary to-background-tertiary border-b-2 border-primary rounded-t-2xl sm:rounded-t-3xl p-6 sm:p-8 lg:p-12 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/10 to-transparent animate-shimmer"></div>
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black mb-3 sm:mb-4 bg-gradient-to-r from-primary via-primary-light to-primary bg-clip-text text-transparent relative z-10 tracking-tight">
                Short Story Pipeline
            </h1>
            <p class="text-sm sm:text-base md:text-lg text-gray-400 relative z-10 max-w-2xl mx-auto">
                Generate distinctive short stories with memorable characters and non-generic language
            </p>
        </header>

        <main class="bg-background-secondary rounded-b-2xl sm:rounded-b-3xl p-4 sm:p-6 lg:p-8 md:p-10">
            <!-- Story Browser Section -->
            <section class="story-browser-section mb-6 sm:mb-8 lg:mb-10 p-4 sm:p-6 bg-background-tertiary rounded-xl sm:rounded-2xl border border-gray-800" id="story-browser-section">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4 sm:mb-6">
                    <h2 class="text-xl sm:text-2xl font-bold text-primary">Story History</h2>
                    <button id="toggle-browser-btn" class="btn-secondary-mobile w-full sm:w-auto">
                        <i data-lucide="eye-off" class="w-4 h-4 inline mr-2"></i>
                        Hide
                    </button>
                </div>
                <div id="story-list" class="story-list min-h-[100px]">
                    <p class="text-center py-8 text-gray-500 italic">Loading stories...</p>
                </div>
            </section>

            <!-- Input Section -->
            <section class="input-section mb-6 sm:mb-8 lg:mb-10">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <h2 class="text-xl sm:text-2xl font-bold text-primary">Create Your Story</h2>
                    <button id="show-browser-btn" type="button" class="btn-secondary-mobile w-full sm:w-auto">
                        <i data-lucide="folder-open" class="w-4 h-4 inline mr-2"></i>
                        Browse Stories
                    </button>
                </div>
                <form id="story-form" class="space-y-5 sm:space-y-6">
                    <div class="form-group">
                        <label for="genre" class="block text-sm font-semibold text-gray-300 mb-2">
                            Genre <span class="text-primary">*</span>
                        </label>
                        <select id="genre" name="genre" required class="form-input">
                            <option value="">Select a genre...</option>
                            {% for genre in genres %}
                            <option value="{{ genre }}">{{ genre }}</option>
                            {% endfor %}
                        </select>
                        <p class="mt-2 text-xs sm:text-sm text-gray-500">Genre selection drives the story framework, outline structure, and stylistic constraints</p>
                    </div>

                    <!-- Optional: Story Templates (for inspiration/examples only) -->
                    <div class="form-group border-l-2 border-gray-700 pl-4 opacity-75">
                        <details class="cursor-pointer">
                            <summary class="text-sm font-medium text-gray-400 hover:text-gray-300 transition-colors select-none">
                                <span class="text-primary">üí°</span> Need inspiration? <span class="text-gray-500 text-xs italic">(Optional - for examples only)</span>
                            </summary>
                            <div class="mt-3 space-y-2">
                                <p class="text-xs text-gray-500 mb-3 italic">If you have your own idea, skip this section. Templates are just example starting points for inspiration - they pre-fill the form fields below with sample ideas, characters, and themes.</p>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <select id="template-select" name="template" class="form-input flex-1">
                                        <option value="">No template - I have my own idea</option>
                                    </select>
                                    <button type="button" id="load-template-btn" class="btn-secondary-mobile sm:w-auto whitespace-nowrap">
                                        <i data-lucide="sparkles" class="w-4 h-4 inline mr-2"></i>
                                        Load Example
                                    </button>
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="form-group">
                        <label for="idea" class="block text-sm font-semibold text-gray-300 mb-2">
                            Story Idea <span class="text-primary">*</span>
                        </label>
                        <textarea 
                            id="idea" 
                            name="idea" 
                            placeholder="A lighthouse keeper who collects lost voices in glass jars..."
                            rows="4"
                            required
                            class="form-input resize-y min-h-[100px]"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="character" class="block text-sm font-semibold text-gray-300 mb-2">
                            Character
                        </label>
                        <textarea 
                            id="character" 
                            name="character" 
                            placeholder="Describe your character: their name, unique quirks, personality traits, and any interesting contradictions. For example: 'Mara is a lighthouse keeper who never speaks above a whisper. She's fiercely protective of those she loves but terrified of forming deep connections. She collects lost voices in glass jars.'"
                            rows="5"
                            class="form-input resize-y min-h-[120px]"
                        ></textarea>
                        <p class="mt-2 text-xs sm:text-sm text-gray-500">Describe your character in plain text - their personality, quirks, and what makes them unique</p>
                    </div>

                    <div class="form-group">
                        <label for="theme" class="block text-sm font-semibold text-gray-300 mb-2">
                            Theme
                        </label>
                        <input 
                            type="text" 
                            id="theme" 
                            name="theme" 
                            placeholder="What happens to the stories we never tell?"
                            class="form-input"
                        >
                    </div>

                    <button type="submit" class="btn-primary-mobile w-full sm:w-auto">
                        <i data-lucide="sparkles" class="w-5 h-5 inline mr-2"></i>
                        Generate Story
                    </button>
                </form>
            </section>

            <!-- Output Section -->
            <section class="output-section mt-8 sm:mt-10 pt-6 sm:pt-8 border-t border-gray-800" id="output-section" style="display: none;">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <h2 class="text-xl sm:text-2xl font-bold text-primary">Your Story</h2>
                    <div class="flex items-center gap-3" id="word-count">
                        <span id="word-count-text" class="text-sm sm:text-base font-semibold text-gray-300">0 / 7,500 words</span>
                        <span id="word-count-status" class="status-indicator"></span>
                    </div>
                </div>

                <div class="editor-container mb-6">
                    <textarea 
                        id="story-editor" 
                        placeholder="Your generated story will appear here..."
                        rows="30"
                        class="w-full min-h-[600px] max-h-[2000px] p-4 sm:p-6 bg-background-tertiary border-2 border-gray-800 rounded-lg sm:rounded-xl text-white font-mono text-sm sm:text-base leading-relaxed resize-y overflow-y-auto focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        style="white-space: pre-wrap; word-wrap: break-word;"
                    ></textarea>
                </div>

                <div class="editor-actions flex flex-wrap gap-2 sm:gap-3 mb-6">
                    <button id="save-btn" class="btn-secondary-mobile">
                        <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                        Save
                    </button>
                    <button id="regenerate-btn" class="btn-secondary-mobile">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                        Regenerate
                    </button>
                    <button id="revise-btn" class="btn-secondary-mobile">
                        <i data-lucide="edit" class="w-4 h-4 inline mr-2"></i>
                        Revise
                    </button>
                    <button id="validate-btn" class="btn-secondary-mobile">
                        <i data-lucide="check-circle" class="w-4 h-4 inline mr-2"></i>
                        Validate
                    </button>
                    <button id="compare-btn" class="btn-secondary-mobile">
                        <i data-lucide="git-compare" class="w-4 h-4 inline mr-2"></i>
                        Compare
                    </button>
                    <div class="export-dropdown relative">
                        <button id="export-btn" class="btn-secondary-mobile">
                            <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
                            Export
                            <i data-lucide="chevron-down" class="w-4 h-4 inline ml-2"></i>
                        </button>
                        <div id="export-menu" class="export-menu absolute top-full left-0 mt-2 hidden z-50">
                            <div class="bg-background-tertiary border border-gray-800 rounded-lg shadow-2xl overflow-hidden min-w-[200px]">
                                <button class="export-option w-full text-left px-4 py-3 hover:bg-background-secondary transition-colors flex items-center gap-2">
                                    <i data-lucide="file-text" class="w-4 h-4"></i>
                                    Export as PDF
                                </button>
                                <button class="export-option w-full text-left px-4 py-3 hover:bg-background-secondary transition-colors flex items-center gap-2" data-format="markdown">
                                    <i data-lucide="file-code" class="w-4 h-4"></i>
                                    Export as Markdown
                                </button>
                                <button class="export-option w-full text-left px-4 py-3 hover:bg-background-secondary transition-colors flex items-center gap-2" data-format="txt">
                                    <i data-lucide="file" class="w-4 h-4"></i>
                                    Export as Text
                                </button>
                                <button class="export-option w-full text-left px-4 py-3 hover:bg-background-secondary transition-colors flex items-center gap-2" data-format="docx">
                                    <i data-lucide="file-text" class="w-4 h-4"></i>
                                    Export as DOCX
                                </button>
                                <button class="export-option w-full text-left px-4 py-3 hover:bg-background-secondary transition-colors flex items-center gap-2" data-format="epub">
                                    <i data-lucide="book" class="w-4 h-4"></i>
                                    Export as EPUB
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="validation-results" class="validation-results" style="display: none;"></div>

                <!-- Revision History Section -->
                <div id="revision-history-section" class="revision-history-section" style="display: none;">
                    <h3>Revision History</h3>
                    <div id="revision-list"></div>
                </div>

                <!-- Comparison Section -->
                <div id="comparison-section" class="comparison-section" style="display: none;">
                    <div class="comparison-header">
                        <h3>Version Comparison</h3>
                        <button id="close-comparison-btn" class="btn btn-small">Close</button>
                    </div>
                    <div class="comparison-controls">
                        <label>Version 1: <select id="compare-version1"></select></label>
                        <label>Version 2: <select id="compare-version2"></select></label>
                        <button id="compare-versions-btn" class="btn btn-secondary">Compare</button>
                    </div>
                    <div id="comparison-results" class="comparison-results"></div>
                </div>
            </section>

            <!-- Loading Indicator -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p id="loading-text">Generating your story...</p>
                <div id="progress-steps" class="progress-steps">
                    <div class="progress-step" id="step-premise">
                        <span class="step-icon">‚óã</span>
                        <span class="step-text">Capturing premise...</span>
                    </div>
                    <div class="progress-step" id="step-outline">
                        <span class="step-icon">‚óã</span>
                        <span class="step-text">Generating outline...</span>
                    </div>
                    <div class="progress-step" id="step-scaffold">
                        <span class="step-icon">‚óã</span>
                        <span class="step-text">Building scaffold...</span>
                    </div>
                    <div class="progress-step" id="step-draft">
                        <span class="step-icon">‚óã</span>
                        <span class="step-text">Writing draft...</span>
                    </div>
                    <div class="progress-step" id="step-revise">
                        <span class="step-icon">‚óã</span>
                        <span class="step-text">Revising story...</span>
                    </div>
                </div>
            </div>

            <!-- Error Messages -->
            <div id="error" class="error" style="display: none;">
                <div class="error-header">
                    <span class="error-icon">‚ö†Ô∏è</span>
                    <span class="error-title">Error</span>
                    <button class="error-close" onclick="this.parentElement.parentElement.style.display='none'">√ó</button>
                </div>
                <div class="error-message"></div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

